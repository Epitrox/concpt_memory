# セマンティック記憶システム構築メモ

以下は、RAG の発展版として設計する「セマンティック記憶システム」の概要です。チャットや外部データから事実を抽出し、グラフ構造で保存・推論できる形に整理することを目的とします。

## 1. 目的
- チャットセッションの履歴を単なるエピソードとして残すのではなく、抽象化された**意味記憶**として保存する。
- 例えば `りんご → 果物 → 甘い` のような階層関係や属性を学習し、質問されたときに自動で推論できる。
- ユーザー個人の情報（好み、閲覧履歴など）もグラフに統合し、文脈に応じた関連知識を呼び出す。

## 2. 基本アーキテクチャ
1. **Episode 層**
   - 会話や出来事をそのまま保存する短期メモリ。
   - 新奇性や重要度をスコア化し、後続処理の優先度に利用。
2. **Semantic 層**
   - LLM で抽出した `isa(りんご, 果物)`、`property(果物, 甘い)` などのファクトを保持。
   - Datalog などの推論エンジンを用いて新規ファクトを生成（例: `property(りんご, 甘い)`）。
   - 確率値（支持回数などから算出）を持たせ、曖昧さを表現。
3. **関連ノード検索**
   - PageRank や BFS により、話題ノード周辺で結び付きの強いノードを抽出。
   - ユーザー情報ノードを一緒にパーソナライズすることで、文脈依存の結果を得る。

## 3. 処理フロー
1. **データ投入**
   - 会話や外部データを取得し、LLM function calling でエンティティと関係を抽出。
   - Episode 層へ原文を保存しつつ、抽出結果を Semantic 層に登録するためのキューに積む。
2. **グラフ更新 & 推論**
   - Soufflé などで差分推論を行い、新しい派生ファクトをグラフ DB に反映。
   - 各ファクトには `support_count` や `last_seen` を記録し、確率値の更新や忘却処理に利用。
3. **問い合わせ時**
   - クエリの意図を分類し、必要であれば Semantic グラフのみで推論回答。
   - 連想拡張が必要なら Personalized PageRank などで関連ノードを取得。
   - Episode 情報が求められる場合は該当ログも検索して併せて提示。

## 4. 期待される効果
- 繰り返し出る事実は自動的に確信度が上がり、質問に対して安定した回答を生成。
- 大量のエピソードを保持せずとも、抽象化された形で重要情報のみ残るため、ストレージを節約。
- ユーザーの興味や履歴に基づいたパーソナライズが容易になり、応答品質が向上。

## 5. 今後の検討事項
- 数値プロパティの扱い（糖度などの連続値継承）。
- データ更新・削除時の伝播戦略。
- 大規模化した際の分散処理やレイテンシ対策。

